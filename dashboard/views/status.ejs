<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Status - CertiFried Announcer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="/css/dashboard-style.css?v=2.0.2">
    <style>
        .stat-card .stat-value { font-size: 2.2rem; font-weight: 800; }
        .stat-card .stat-label { font-size: 0.9rem; color: var(--text-muted); text-transform: uppercase; }
        .streamer-avatar { width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--success-color); }
    </style>
</head>
<body>
<%- include('partials/header') %>
<main class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="display-4">System Status</h1>
        <% if (statusData && !error) { %>
            <p class="text-muted small mb-0">Last Updated: <%= new Date().toLocaleTimeString() %></p>
        <% } %>
    </div>

    <% 
    const statusClasses = {
        OFFLINE: 'alert-dark',
        STARTING: 'alert-info',
        ONLINE: 'alert-success',
        MAINTENANCE: 'alert-warning',
        ERROR: 'alert-danger'
    }; 
    const status = botStatus || { state: 'ERROR', message: 'Could not retrieve bot status.' };
    %>
    <div class="alert text-center <%= statusClasses[status.state] || 'alert-secondary' %>" role="alert">
        <%= status.message %>
    </div>

    <% if (error) { %>
        <div class="alert alert-danger text-center" role="alert">
            <%= error %>
        </div>
    <% } else if (statusData) { %>
        <div class="row g-4 mb-5">
            <div class="col-md-3"><div class="stat-card card card-body"><div class="stat-label">Live Now</div><div class="stat-value"><%= statusData.liveCount %></div></div></div>
            <div class="col-md-3"><div class="stat-card card card-body"><div class="stat-label">Total Tracked</div><div class="stat-value"><%= statusData.totalStreamers %></div></div></div>
            <div class="col-md-3"><div class="stat-card card card-body"><div class="stat-label">Total Guilds</div><div class="stat-value"><%= statusData.totalGuilds %></div></div></div>
            <div class="col-md-3"><div class="stat-card card card-body"><div class="stat-label">Announcements</div><div class="stat-value"><%= statusData.totalAnnouncements %></div></div></div>
        </div>

        <div>
            <h2 class="mb-3">Live Now (<%= statusData.liveCount %>)</h2>
            <div class="row g-3">
                <% if (statusData.liveStreamers && statusData.liveStreamers.length > 0) { %>
                    <% statusData.liveStreamers.forEach(streamer => { %>
                        <div class="col-md-6 col-lg-4">
                            <div class="card card-body d-flex flex-row align-items-center">
                                <img src="<%= streamer.avatar_url || '/images/default-icon.png' %>" class="streamer-avatar me-3">
                                <div>
                                    <h5 class="mb-0"><%= streamer.username %></h5>
                                    <span class="badge bg-secondary"><%= streamer.platform %></span>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="col"><p class="text-muted">No one is live right now.</p></div>
                <% } %>
            </div>
        </div>
    <% } else { %>
        <div class="text-center p-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-muted mt-2">Loading system data...</p>
        </div>
    <% } %>
</main>
<%- include('partials/footer') %>
</body>
</html>