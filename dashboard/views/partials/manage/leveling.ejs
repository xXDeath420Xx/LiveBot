<div class="row">
    <div class="col-12">
        <h3>Leveling</h3>
        <p class="text-muted">Reward your members for their activity with XP and levels.</p>
    </div>
</div>

<div class="content-card mt-4">
    <div class="card-body">
        <h4 class="card-title">Leveling System Settings</h4>
        <p class="card-subtitle mb-3 text-muted">Configure how the leveling system works.</p>
        <form action="/manage/<%= guild.id %>/update-leveling" method="POST">
            <div class="row">
                <div class="col-md-4">
                     <div class="mb-3">
                        <label class="form-label">Enable Leveling System</label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" role="switch" name="leveling_enabled" <%= settings.leveling_enabled ? 'checked' : '' %>>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">XP Rate (per message)</label>
                        <input type="number" class="form-control" name="leveling_xp_rate" value="<%= settings.leveling_xp_rate || 15 %>">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">XP Cooldown (seconds)</label>
                        <input type="number" class="form-control" name="leveling_xp_cooldown" value="<%= settings.leveling_xp_cooldown || 60 %>">
                    </div>
                </div>
            </div>
           
            <div class="mb-3">
                <label class="form-label">Ignored Channels</label>
                <select class="form-select" name="leveling_ignored_channels" multiple size="4">
                    <% channels.forEach(channel => { %>
                        <option value="<%= channel.id %>" <%= (settings.leveling_ignored_channels || '[]').includes(channel.id) ? 'selected' : '' %> >#<%= channel.name %></option>
                    <% }) %>
                </select>
            </div>
             <div class="mb-3">
                <label class="form-label">Ignored Roles</label>
                <select class="form-select" name="leveling_ignored_roles" multiple size="4">
                    <% roles.forEach(role => { %>
                        <option value="<%= role.id %>" <%= (settings.leveling_ignored_roles || '[]').includes(role.id) ? 'selected' : '' %> >@<%= role.name %></option>
                    <% }) %>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Save Settings</button>
        </form>
    </div>
</div>

<div class="content-card mt-4">
    <div class="card-body">
        <h4 class="card-title">Role Rewards</h4>
        <p class="card-subtitle mb-3 text-muted">Automatically assign roles to members when they reach a certain level.</p>
        
        <form action="/manage/<%= guild.id %>/add-role-reward" method="POST" class="row g-3 mb-4 align-items-end">
            <div class="col-md-4">
                <label class="form-label">Level Required</label>
                <input type="number" name="level" class="form-control" required min="1">
            </div>
            <div class="col-md-5">
                <label class="form-label">Role to Award</label>
                <select name="role_id" class="form-select" required>
                    <% roles.forEach(role => { %>
                        <option value="<%= role.id %>">@<%= role.name %></option>
                    <% }); %>
                </select>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100"><i class="fas fa-plus me-2"></i>Add Reward</button>
            </div>
        </form>

        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>Level</th>
                    <th>Role</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <% if (rewards && rewards.length > 0) { %>
                    <% rewards.forEach(reward => { %>
                        <tr>
                            <td><%= reward.level %></td>
                            <td>@<%= roles.find(r => r.id === reward.role_id) ? roles.find(r => r.id === reward.role_id).name : 'Unknown Role' %></td>
                            <td>
                                <form action="/manage/<%= guild.id %>/remove-role-reward" method="POST" class="d-inline">
                                    <input type="hidden" name="rewardId" value="<%= reward.id %>">
                                    <button type="submit" class="btn btn-sm btn-danger">Remove</button>
                                </form>
                            </td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <tr>
                        <td colspan="3" class="text-center">No role rewards configured.</td>
                    </tr>
                <% } %>
                </tbody>
            </table>
        </div>
    </div>
</div>