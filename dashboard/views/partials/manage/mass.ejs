<div class="page-section">
    <div class="page-section-header">
        <div>
            <div class="page-section-title">
                <i class="fas fa-users-cog"></i>
                <span>Mass Actions</span>
            </div>
            <div class="page-section-subtitle">
                Perform bulk operations on members, roles, and server content
            </div>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="grid grid-cols-4" style="margin-bottom: var(--spacing-6);">
        <div style="background: var(--color-dark-600); padding: var(--spacing-4); border-radius: var(--radius-md); border: 1px solid var(--color-dark-400);">
            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Total Members</div>
            <div style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); color: var(--color-primary-400);">
                <%= guild.memberCount || 0 %>
            </div>
        </div>
        <div style="background: var(--color-dark-600); padding: var(--spacing-4); border-radius: var(--radius-md); border: 1px solid var(--color-dark-400);">
            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Total Roles</div>
            <div style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); color: var(--color-accent-purple);">
                <%= roles ? roles.length : 0 %>
            </div>
        </div>
        <div style="background: var(--color-dark-600); padding: var(--spacing-4); border-radius: var(--radius-md); border: 1px solid var(--color-dark-400);">
            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Text Channels</div>
            <div style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); color: var(--color-accent-orange);">
                <%= channels ? channels.length : 0 %>
            </div>
        </div>
        <div style="background: var(--color-dark-600); padding: var(--spacing-4); border-radius: var(--radius-md); border: 1px solid var(--color-dark-400);">
            <div style="font-size: var(--font-size-xs); color: var(--color-text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Server Boost</div>
            <div style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); color: var(--color-success);">
                Tier <%= guild.premiumTier || 0 %>
            </div>
        </div>
    </div>

    <!-- Mass Member Actions -->
    <div style="margin-bottom: var(--spacing-6);">
        <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--spacing-4);">
            <i class="fas fa-users" style="color: var(--color-primary-400); margin-right: var(--spacing-2);"></i>
            Mass Member Actions
        </h3>

        <div class="grid grid-cols-2" style="gap: var(--spacing-4);">
            <!-- Mass Role Assignment -->
            <div style="background: var(--color-dark-600); border: 1px solid var(--color-dark-400); border-radius: var(--radius-lg); padding: var(--spacing-6);">
                <div style="display: flex; align-items: center; gap: var(--spacing-3); margin-bottom: var(--spacing-4);">
                    <div style="width: 48px; height: 48px; background: var(--color-primary-500); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-user-plus" style="font-size: var(--font-size-xl); color: white;"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--spacing-1);">Assign Role to Members</div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-text-muted);">Add a role to multiple users at once</div>
                    </div>
                </div>
                <form action="/manage/<%= guild.id %>/mass-assign-role" method="POST">
                    <div style="margin-bottom: var(--spacing-3);">
                        <label class="form-label">Role to Assign</label>
                        <select class="form-select" name="roleId" required>
                            <option value="">Select a role</option>
                            <% roles.forEach(role => { %>
                                <option value="<%= role.id %>"><%= role.name %></option>
                            <% }) %>
                        </select>
                    </div>
                    <div style="margin-bottom: var(--spacing-3);">
                        <label class="form-label">Target Members (User IDs, comma-separated)</label>
                        <textarea class="form-control" name="userIds" rows="3" placeholder="123456789012345678, 234567890123456789" required></textarea>
                        <div class="form-help">Enter user IDs separated by commas</div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-user-plus"></i>
                        <span>Assign Role</span>
                    </button>
                </form>
            </div>

            <!-- Mass Role Removal -->
            <div style="background: var(--color-dark-600); border: 1px solid var(--color-dark-400); border-radius: var(--radius-lg); padding: var(--spacing-6);">
                <div style="display: flex; align-items: center; gap: var(--spacing-3); margin-bottom: var(--spacing-4);">
                    <div style="width: 48px; height: 48px; background: var(--color-danger); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-user-minus" style="font-size: var(--font-size-xl); color: white;"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--spacing-1);">Remove Role from Members</div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-text-muted);">Remove a role from multiple users at once</div>
                    </div>
                </div>
                <form action="/manage/<%= guild.id %>/mass-remove-role" method="POST">
                    <div style="margin-bottom: var(--spacing-3);">
                        <label class="form-label">Role to Remove</label>
                        <select class="form-select" name="roleId" required>
                            <option value="">Select a role</option>
                            <% roles.forEach(role => { %>
                                <option value="<%= role.id %>"><%= role.name %></option>
                            <% }) %>
                        </select>
                    </div>
                    <div style="margin-bottom: var(--spacing-3);">
                        <label class="form-label">Target Members (User IDs, comma-separated)</label>
                        <textarea class="form-control" name="userIds" rows="3" placeholder="123456789012345678, 234567890123456789" required></textarea>
                        <div class="form-help">Enter user IDs separated by commas</div>
                    </div>
                    <button type="submit" class="btn btn-danger" style="width: 100%;">
                        <i class="fas fa-user-minus"></i>
                        <span>Remove Role</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Mass Moderation Actions -->
    <div style="margin-bottom: var(--spacing-6);">
        <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--spacing-4);">
            <i class="fas fa-gavel" style="color: var(--color-danger); margin-right: var(--spacing-2);"></i>
            Mass Moderation Actions
        </h3>

        <div style="background: var(--color-dark-600); border: 1px solid var(--color-danger); border-radius: var(--radius-lg); padding: var(--spacing-6);">
            <div style="background: var(--color-dark-700); border-left: 4px solid var(--color-danger); padding: var(--spacing-4); border-radius: var(--radius-sm); margin-bottom: var(--spacing-4);">
                <div style="font-weight: var(--font-weight-semibold); color: var(--color-text-primary); margin-bottom: var(--spacing-2);">
                    <i class="fas fa-exclamation-triangle" style="color: var(--color-danger); margin-right: var(--spacing-2);"></i>
                    Danger Zone
                </div>
                <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                    These actions cannot be undone. Use with extreme caution and ensure you have the correct user IDs.
                </div>
            </div>

            <div class="grid grid-cols-2" style="gap: var(--spacing-4);">
                <!-- Mass Kick -->
                <div style="background: var(--color-dark-700); border: 1px solid var(--color-dark-500); border-radius: var(--radius-md); padding: var(--spacing-4);">
                    <div style="font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--spacing-3); display: flex; align-items: center; gap: var(--spacing-2);">
                        <i class="fas fa-door-open" style="color: var(--color-accent-orange);"></i>
                        Mass Kick
                    </div>
                    <form action="/manage/<%= guild.id %>/mass-kick" method="POST" onsubmit="return confirm('Are you sure you want to kick these members? This action cannot be undone.');">
                        <div style="margin-bottom: var(--spacing-3);">
                            <label class="form-label">User IDs to Kick</label>
                            <textarea class="form-control" name="userIds" rows="3" placeholder="123456789012345678, 234567890123456789" required></textarea>
                        </div>
                        <div style="margin-bottom: var(--spacing-3);">
                            <label class="form-label">Reason</label>
                            <input type="text" class="form-control" name="reason" placeholder="Mass moderation action" required>
                        </div>
                        <button type="submit" class="btn btn-danger" style="width: 100%;">
                            <i class="fas fa-door-open"></i>
                            <span>Kick Members</span>
                        </button>
                    </form>
                </div>

                <!-- Mass Ban -->
                <div style="background: var(--color-dark-700); border: 1px solid var(--color-danger); border-radius: var(--radius-md); padding: var(--spacing-4);">
                    <div style="font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--spacing-3); display: flex; align-items: center; gap: var(--spacing-2);">
                        <i class="fas fa-hammer" style="color: var(--color-danger);"></i>
                        Mass Ban
                    </div>
                    <form action="/manage/<%= guild.id %>/mass-ban" method="POST" onsubmit="return confirm('Are you sure you want to BAN these members? This is a PERMANENT action!');">
                        <div style="margin-bottom: var(--spacing-3);">
                            <label class="form-label">User IDs to Ban</label>
                            <textarea class="form-control" name="userIds" rows="3" placeholder="123456789012345678, 234567890123456789" required></textarea>
                        </div>
                        <div style="margin-bottom: var(--spacing-3);">
                            <label class="form-label">Reason</label>
                            <input type="text" class="form-control" name="reason" placeholder="Mass moderation action" required>
                        </div>
                        <div style="margin-bottom: var(--spacing-3);">
                            <label class="form-label">Delete Message History (days)</label>
                            <select class="form-select" name="deleteMessageDays">
                                <option value="0">Don't delete messages</option>
                                <option value="1">1 day</option>
                                <option value="7" selected>7 days</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-danger" style="width: 100%;">
                            <i class="fas fa-hammer"></i>
                            <span>Ban Members</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- CSV Import/Export -->
    <div>
        <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--spacing-4);">
            <i class="fas fa-file-csv" style="color: var(--color-success); margin-right: var(--spacing-2);"></i>
            CSV Import & Export
        </h3>

        <div class="grid grid-cols-2" style="gap: var(--spacing-4);">
            <!-- Export -->
            <div style="background: var(--color-dark-600); border: 1px solid var(--color-dark-400); border-radius: var(--radius-lg); padding: var(--spacing-6);">
                <div style="display: flex; align-items: center; gap: var(--spacing-3); margin-bottom: var(--spacing-4);">
                    <div style="width: 48px; height: 48px; background: var(--color-success); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-download" style="font-size: var(--font-size-xl); color: white;"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--spacing-1);">Export Data</div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-text-muted);">Download member data as CSV</div>
                    </div>
                </div>
                <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-4);">
                    Export all streamer subscriptions for this server into a single CSV file. Useful for backups or migrating to another server.
                </p>
                <a href="/manage/<%= guild.id %>/export" class="btn btn-success" style="width: 100%; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: var(--spacing-2);">
                    <i class="fas fa-download"></i>
                    <span>Export All Subscriptions</span>
                </a>
            </div>

            <!-- Import -->
            <div style="background: var(--color-dark-600); border: 1px solid var(--color-dark-400); border-radius: var(--radius-lg); padding: var(--spacing-6);">
                <div style="display: flex; align-items: center; gap: var(--spacing-3); margin-bottom: var(--spacing-4);">
                    <div style="width: 48px; height: 48px; background: var(--color-primary-500); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-upload" style="font-size: var(--font-size-xl); color: white;"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--spacing-1);">Sync Channel from CSV</div>
                        <div style="font-size: var(--font-size-sm); color: var(--color-text-muted);">Import and sync data from CSV file</div>
                    </div>
                </div>
                <form action="/manage/<%= guild.id %>/import-team" method="POST" enctype="multipart/form-data">
                    <div style="margin-bottom: var(--spacing-3);">
                        <label class="form-label">Channel to Sync</label>
                        <select name="channelId" class="form-select" required>
                            <option value="" disabled selected>Select a channel</option>
                            <% channels.forEach(channel => { %>
                                <option value="<%= channel.id %>">#<%= channel.name %></option>
                            <% }) %>
                        </select>
                    </div>
                    <div style="margin-bottom: var(--spacing-3);">
                        <label class="form-label">CSV File</label>
                        <input class="form-control" type="file" name="csvfile" accept=".csv" required style="padding: var(--spacing-2);">
                    </div>
                    <div style="background: var(--color-dark-700); border-left: 4px solid var(--color-warning); padding: var(--spacing-3); border-radius: var(--radius-sm); margin-bottom: var(--spacing-3);">
                        <div style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">
                            <i class="fas fa-exclamation-triangle" style="color: var(--color-warning); margin-right: var(--spacing-1);"></i>
                            This will remove any streamers from that channel who are not in the file.
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-upload"></i>
                        <span>Sync from CSV</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Usage Tips -->
    <div style="margin-top: var(--spacing-6); background: var(--color-dark-600); border: 1px solid var(--color-dark-400); border-radius: var(--radius-lg); padding: var(--spacing-6);">
        <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--spacing-4);">
            <i class="fas fa-lightbulb" style="color: var(--color-warning); margin-right: var(--spacing-2);"></i>
            Tips for Mass Actions
        </h3>
        <div class="grid grid-cols-2" style="gap: var(--spacing-4);">
            <div>
                <div style="font-weight: var(--font-weight-semibold); color: var(--color-primary-400); margin-bottom: var(--spacing-2);">
                    <i class="fas fa-id-card" style="margin-right: var(--spacing-2);"></i>
                    Getting User IDs
                </div>
                <ul style="margin: 0; padding-left: var(--spacing-6); color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                    <li style="margin-bottom: var(--spacing-1);">Enable Developer Mode in Discord Settings</li>
                    <li style="margin-bottom: var(--spacing-1);">Right-click on a user and select "Copy User ID"</li>
                    <li style="margin-bottom: var(--spacing-1);">Separate multiple IDs with commas</li>
                    <li>Use the Member List to get IDs in bulk</li>
                </ul>
            </div>
            <div>
                <div style="font-weight: var(--font-weight-semibold); color: var(--color-success); margin-bottom: var(--spacing-2);">
                    <i class="fas fa-shield-alt" style="margin-right: var(--spacing-2);"></i>
                    Best Practices
                </div>
                <ul style="margin: 0; padding-left: var(--spacing-6); color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                    <li style="margin-bottom: var(--spacing-1);">Always double-check user IDs before mass actions</li>
                    <li style="margin-bottom: var(--spacing-1);">Test with a small batch first</li>
                    <li style="margin-bottom: var(--spacing-1);">Export data regularly for backups</li>
                    <li>Document reasons for mass moderation actions</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
.form-label {
    display: block;
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-2);
}

.form-control, .form-select {
    width: 100%;
    padding: var(--spacing-3);
    background: var(--color-dark-700);
    border: 1px solid var(--color-dark-400);
    border-radius: var(--radius-md);
    color: var(--color-text-primary);
    font-size: var(--font-size-sm);
    transition: all var(--transition-base);
}

.form-control:focus, .form-select:focus {
    outline: none;
    border-color: var(--color-primary-500);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.form-help {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    margin-top: var(--spacing-2);
}

textarea.form-control {
    resize: vertical;
    font-family: var(--font-mono);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Format user ID inputs
    const userIdInputs = document.querySelectorAll('textarea[name="userIds"]');

    userIdInputs.forEach(input => {
        input.addEventListener('blur', function() {
            // Clean up the input - remove extra spaces and normalize commas
            let value = this.value.trim();
            value = value.replace(/\s*,\s*/g, ', '); // Normalize spacing around commas
            value = value.replace(/\s+/g, ' '); // Remove extra spaces
            this.value = value;
        });
    });

    // Add confirmation for dangerous actions
    const dangerForms = document.querySelectorAll('form[action*="mass-kick"], form[action*="mass-ban"]');

    dangerForms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const userIds = this.querySelector('textarea[name="userIds"]').value;
            const count = userIds.split(',').filter(id => id.trim()).length;
            const action = this.action.includes('mass-kick') ? 'kick' : 'ban';

            if (count === 0) {
                e.preventDefault();
                alert('Please enter at least one user ID.');
                return;
            }

            if (!confirm(`Are you sure you want to ${action} ${count} member(s)? This action cannot be undone!`)) {
                e.preventDefault();
            }
        });
    });

    // File upload feedback
    const fileInputs = document.querySelectorAll('input[type="file"]');

    fileInputs.forEach(input => {
        input.addEventListener('change', function() {
            if (this.files.length > 0) {
                const file = this.files[0];
                if (!file.name.endsWith('.csv')) {
                    alert('Please select a CSV file.');
                    this.value = '';
                }
            }
        });
    });
});
</script>
