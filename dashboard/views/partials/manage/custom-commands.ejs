<div class="plugin-card">
    <div class="plugin-card-header">
        <h4><i class="fas fa-terminal me-2"></i> Custom Commands</h4>
    </div>
    <div class="plugin-card-body">
        <p class="text-muted">Create custom commands with variables and actions.</p>
        
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Command Name</th>
                        <th>Action</th>
                        <th>Response</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% customCommands.forEach(cmd => { %>
                        <tr>
                            <td><code>!<%= cmd.command_name %></code></td>
                            <td><span class="badge bg-secondary"><%= cmd.action_type.replace('_', ' ') %></span></td>
                            <td style="white-space: pre-wrap; word-break: break-word;"><%= cmd.response %></td>
                            <td>
                                <form action="/manage/<%= guild.id %>/delete-custom-command" method="POST" class="d-inline">
                                    <input type="hidden" name="commandId" value="<%= cmd.id %>">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>

        <hr class="my-4">

        <h5>Add New Command</h5>
        <form action="/manage/<%= guild.id %>/add-custom-command" method="POST">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label">Command Name (no prefix)</label>
                    <input type="text" class="form-control" name="command_name" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Action</label>
                    <select class="form-select" name="action_type" id="action-type-select">
                        <option value="reply">Reply in channel</option>
                        <option value="send_to_channel">Send to a specific channel</option>
                        <option value="dm_user">Send as a DM</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3" id="action-content-container" style="display: none;">
                    <label class="form-label">Target Channel</label>
                    <select class="form-select" name="action_content">
                        <% channels.forEach(channel => { %>
                            <option value="<%= channel.id %>">#<%= channel.name %></option>
                        <% }); %>
                    </select>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">Response Text</label>
                <textarea class="form-control" name="response" rows="3" required></textarea>
            </div>
            <button type="submit" class="btn btn-success">Add Command</button>
        </form>

        <div class="mt-4 p-3 rounded" style="background-color: var(--bg-primary);">
            <h6>Available Variables</h6>
            <div class="d-flex flex-wrap gap-2">
                <code class="p-1">{user.name}</code>
                <code class="p-1">{user.mention}</code>
                <code class="p-1">{user.id}</code>
                <code class="p-1">{user.tag}</code>
                <code class="p-1">{channel.name}</code>
                <code class="p-1">{channel.mention}</code>
                <code class="p-1">{channel.id}</code>
                <code class="p-1">{server.name}</code>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('action-type-select').addEventListener('change', function() {
        const container = document.getElementById('action-content-container');
        if (this.value === 'send_to_channel') {
            container.style.display = 'block';
        } else {
            container.style.display = 'none';
        }
    });
</script>